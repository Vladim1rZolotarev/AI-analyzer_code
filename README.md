# AI-analyzer_code

# Графическая схема работы скрипта анализа AI-генерированного кода

Ниже представлена схема работы скрипта `ai_code_analyzer_final.py`, который анализирует коммиты Git на наличие AI-генерированного кода и сохраняет результаты в базу данных PostgreSQL.

```mermaid
flowchart TD
    A[Запуск скрипта] --> B[Получение параметров<br>репозиторий и хеш коммита]
    B --> C{Проверка<br>существования<br>репозитория}
    C -->|Репозиторий<br>существует| D[Получение информации<br>о коммите]
    C -->|Репозиторий<br>не существует| Z[Ошибка: репозиторий<br>не найден]
    
    D --> E{Проверка<br>наличия родителей<br>у коммита}
    
    E -->|Есть родители| F[Получение diff<br>с родительским коммитом]
    E -->|Нет родителей| G[Анализ всех файлов<br>в коммите напрямую]
    
    F -->|Успешно| H[Анализ diff<br>на наличие AI-кода]
    F -->|Ошибка| G
    
    G --> I[Обход всех файлов<br>в коммите]
    I --> J[Определение типа файла<br>по расширению]
    J --> K[Применение соответствующих<br>шаблонов комментариев]
    K --> L[Анализ содержимого файла<br>на наличие AI-кода]
    
    H --> M[Подсчет общего количества<br>строк и AI-строк]
    L --> M
    
    M --> N[Генерация отчета]
    N --> O[Сохранение отчета<br>в файл ai_report.txt]
    N --> P[Сохранение данных<br>в базу данных PostgreSQL]
    
    P --> Q[Вывод содержимого<br>таблицы ai_reports]
    O --> R[Завершение работы<br>скрипта]
    Q --> R
    
    subgraph "Анализ файла"
        AA[Чтение содержимого файла] --> BB{Проверка<br>каждой строки}
        BB -->|Маркер начала AI-блока| CC[Включение режима<br>AI-блока]
        BB -->|Маркер конца AI-блока| DD[Выключение режима<br>AI-блока]
        BB -->|Обычная строка| EE{Находимся<br>в AI-блоке?}
        EE -->|Да| FF[Увеличение счетчика<br>AI-строк]
        EE -->|Нет| GG[Увеличение счетчика<br>обычных строк]
        CC --> BB
        DD --> BB
        FF --> BB
        GG --> BB
    end
    
    subgraph "База данных PostgreSQL"
        TA[(Таблица ai_reports)] --> TB[id: SERIAL PRIMARY KEY]
        TA --> TC[commit_hash: VARCHAR]
        TA --> TD[commit_message: TEXT]
        TA --> TE[author_name: VARCHAR]
        TA --> TF[author_email: VARCHAR]
        TA --> TG[total_lines: INTEGER]
        TA --> TH[ai_lines: INTEGER]
        TA --> TI[ai_percentage: NUMERIC]
        TA --> TJ[report_date: TIMESTAMP]
    end
    
    subgraph "Поддерживаемые форматы комментариев"
        CA[JavaScript/Java/C/C++/C#] --> CB["// AI-generated start"]
        CA --> CC["// AI-generated end"]
        CD[Python/Ruby/Shell] --> CE["# AI-generated start"]
        CD --> CF["# AI-generated end"]
        CG[HTML/XML] --> CH["<!-- AI-generated start -->"]
        CG --> CI["<!-- AI-generated end -->"]
        CJ[CSS/SCSS/Less] --> CK["/* AI-generated start */"]
        CJ --> CL["/* AI-generated end */"]
    end
```

## Описание основных компонентов схемы

1. **Запуск и инициализация**:
   - Скрипт принимает два параметра: путь к репозиторию и хеш коммита
   - Проверяет существование репозитория и доступность коммита

2. **Анализ коммита**:
   - Для обычных коммитов: анализирует diff с родительским коммитом
   - Для первого коммита: анализирует все файлы напрямую
   - При ошибках с diff: переключается на прямой анализ файлов

3. **Анализ файлов**:
   - Определяет тип файла по расширению
   - Применяет соответствующие шаблоны комментариев
   - Анализирует содержимое файла строка за строкой
   - Подсчитывает общее количество строк и AI-строк

4. **Генерация отчета**:
   - Создает подробный отчет с информацией о коммите
   - Дозаписывает отчет в файл ai_report.txt
   - Сохраняет данные в базу данных PostgreSQL
   - Выводит содержимое таблицы ai_reports

5. **База данных**:
   - Таблица ai_reports содержит информацию о проанализированных коммитах
   - Каждая запись включает хеш коммита, сообщение, автора, количество строк и процент AI-кода

6. **Поддерживаемые форматы комментариев**:
   - JavaScript/Java/C/C++/C#: `// AI-generated start` и `// AI-generated end`
   - Python/Ruby/Shell: `# AI-generated start` и `# AI-generated end`
   - HTML/XML: `<!-- AI-generated start -->` и `<!-- AI-generated end -->`
   - CSS/SCSS/Less: `/* AI-generated start */` и `/* AI-generated end */`

Эта схема наглядно демонстрирует процесс работы скрипта, начиная от получения параметров и заканчивая сохранением результатов анализа в базу данных и файл отчета.
